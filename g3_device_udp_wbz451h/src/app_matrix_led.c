/*******************************************************************************
  MPLAB Harmony Application Source File

  Company:
    Microchip Technology Inc.

  File Name:
    app_matrix_led.c

  Summary:
    This file contains the source code for the MPLAB Harmony application.

  Description:
    This file contains the source code for the MPLAB Harmony application.  It
    implements the logic of the application's state machine and it may call
    API routines of other MPLAB Harmony modules in the system, such as drivers,
    system services, and middleware.  However, it does not call any of the
    system interfaces (such as the "Initialize" and "Tasks" functions) of any of
    the modules in the system or make any assumptions about when those functions
    are called.  That is the responsibility of the configuration-specific system
    files.
 ******************************************************************************/

// *****************************************************************************
// *****************************************************************************
// Section: Included Files
// *****************************************************************************
// *****************************************************************************
#include "definitions.h"
#include "core.h"
#include "app_matrix_led.h"

// *****************************************************************************
// *****************************************************************************
// Section: Global Data Definitions
// *****************************************************************************
// *****************************************************************************

/*
 typedef struct {
     const uint8_t *data;
     uint16_t width;
     uint16_t height;
     uint8_t dataSize;
     } tImage;
*/

static const uint8_t image_data_Microchip_64_32[2048] = {
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0
};

static const uint8_t image_data_Alarm_64_32[2048] = {
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,  
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
    1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0, 
};

uint8_t rgbPins[]  = {PANEL_R1_PIN, PANEL_R2_PIN, PANEL_B1_PIN, PANEL_B2_PIN, PANEL_B1_PIN, PANEL_B2_PIN};
uint8_t addrPins[] = {PANEL_A_PIN, PANEL_B_PIN, PANEL_C_PIN, PANEL_D_PIN};
uint8_t clockPin   = PANEL_CLK_PIN;
uint8_t latchPin   = PANEL_LAT_PIN;
uint8_t oePin      = PANEL_OE_PIN;
  
extern Protomatter_core *_PM_protoPtr; 
Protomatter_core core_proto;

uintptr_t timer;

// *****************************************************************************
/* Application Data

  Summary:
    Holds application data

  Description:
    This structure holds the application's data.

  Remarks:
    This structure should be initialized by the APP_UDP_RESPONDER_Initialize
    function.

    Application strings and buffers are be defined outside this structure.
*/

APP_MATRIX_LED_DATA app_matrix_ledData;

#define PIXEL_COLUMNS 64
#define PIXEL_FILES 32   // (2x16)

#define APP_MATRIX_LED_TIMER_PERIOD_OFF 15
#define APP_MATRIX_LED_TIMER_PERIOD_ON 5
#define APP_MATRIX_LED_TIMER_PERIOD 1

// *****************************************************************************
// *****************************************************************************
// Section: Application Callback Functions
// *****************************************************************************
// *****************************************************************************

APP_MATRIX_LED matrix[PIXEL_FILES][PIXEL_COLUMNS];

// PIN ASSOCIATION


// Latch => move shift register bits to pixels
#define LAT_Set()   PANEL_LAT_Set()    //PA1
#define LAT_Clear() PANEL_LAT_Clear()

// Move bits to shift register
#define CLK_Set()   PANEL_CLK_Set()    //PB2
#define CLK_Clear() PANEL_CLK_Clear()

// Global Output Switch to turn on/off all the pixels -brightness and consumption
#define OE_Set()    PANEL_OE_Set()     //PB12
#define OE_Clear()  PANEL_OE_Clear()


#define R1_Set()    PANEL_R1_Set()     //PA7 
#define R1_Clear()  PANEL_R1_Clear()
#define R2_Set()    PANEL_R2_Set()     //PA6
#define R2_Clear()  PANEL_R2_Clear()   //

#define G1_Set()   //PA7_Set()         //
#define G1_Clear() //PA7_Clear()       //
#define G2_Set()   //PA7_Set()
#define G2_Clear() //PA7_Clear()

#define B1_Set()    PANEL_B1_Set()
#define B1_Clear()  PANEL_B1_Clear()
#define B2_Set()    PANEL_B2_Set()
#define B2_Clear()  PANEL_B2_Clear()

#define A_Set()    PANEL_A_Set()
#define A_Clear()  PANEL_A_Clear()

#define B_Set()    PANEL_B_Set()
#define B_Clear()  PANEL_B_Clear()

#define C_Set()    PANEL_C_Set()
#define C_Clear()  PANEL_C_Clear()

#define D_Set()    PANEL_D_Set()   //PA5
#define D_Clear()  PANEL_D_Clear() //

#define APP_MATRIX_LED_SwitchOnPanel()  { PANEL_OE_Clear(); app_matrix_ledData.panelLEDon = true ; }
#define APP_MATRIX_LED_SwitchOffPanel() { PANEL_OE_Set(); app_matrix_ledData.panelLEDon = false ; }


/*******************************************************************************
  Function:
    Timer in milliseconds for creating and waiting the delay.
 */

bool APP_MATRIX_LED_TaskDelay(uint32_t ms, SYS_TIME_HANDLE* handle)
{
    // Check if there is the timer has been created and running
    if (*handle == SYS_TIME_HANDLE_INVALID)
    {
        // Create timer
        if (SYS_TIME_DelayMS(ms, handle) != SYS_TIME_SUCCESS)
        {
            return false;
        }
    }
    else
    {
        // Check timer
        if (SYS_TIME_DelayIsComplete(*handle) == true)
        {
            *handle = SYS_TIME_HANDLE_INVALID;
            return true;
        }
    }

    return false;
}

void APP_MATRIX_LED_RefreshPanel(uint8_t *panel)
{
    int i,j;
    
    APP_MATRIX_LED_SwitchOffPanel();
    
    LAT_Clear();
    LAT_Set();
    LAT_Clear();
    
    // For Each Line    
    for (i=0; i<(PIXEL_FILES/2); i++)
    {   
        // Set Line Address
        if (i&0x01)
            A_Set();
        else 
            A_Clear();

        if (i&0x02)
            B_Set();
        else
            B_Clear();

        if (i&0x04)
            C_Set();
        else
            C_Clear();

        if (i&0x08)
            D_Set();
        else
            D_Clear();

        for (j=0; j<(PIXEL_COLUMNS); j++)
        {
            // For Each Column
            // Clock Down
            CLK_Clear();
                        
            // Update Red bits
            if (*panel)
            {
                R1_Clear();
                B1_Set();
            } else 
            {
                R1_Set();
                B1_Clear();
            }
            if (*(panel + 1024))
            {
                R2_Clear();
                B2_Set();
            }
            else 
            {
                R2_Set();
                B2_Clear();
            }    
#if 0            
            // Update Green bits
            if (matrix[i][j].g)
                G1_Set();
            else 
                G1_Clear();

            if (matrix[i + (PIXEL_FILES/2)][j].g)
                G2_Set();
            else 
                G2_Clear();
            
            // Update Blue bits
            if (matrix[i][j].b)
                B1_Set();
            else 
                B1_Clear();

            if (matrix[i + (PIXEL_FILES/2)][j].b)
                B2_Set();
            else 
                B2_Clear();
#endif
            panel++;

            //LAT_Set();
            
            //Clock Up
            CLK_Set();
        }
        CLK_Clear();
    }
    
    //LAT_Set();
    //APP_MATRIX_LED_TaskDelay(1,handle);
    //LAT_Clear();
    //APP_MATRIX_LED_TaskDelay(1,handle);
    APP_MATRIX_LED_SwitchOnPanel();
}

void _APP_MATRIX_LED_TimeExpired(uintptr_t context)
{
    static int times = 0;
    
    *((bool *) context) = true;

    APP_MATRIX_LED_RefreshPanel(image_data_Microchip_64_32);
    
    if (app_matrix_ledData.panelLEDon)
    {
        app_matrix_ledData.panelLEDon = false;
        //APP_MATRIX_LED_SwitchOffPanel();       
        //app_matrix_ledData.timeout_ms = APP_MATRIX_LED_TIMER_PERIOD_OFF;
    }else
    {
        app_matrix_ledData.panelLEDon = true;
        APP_MATRIX_LED_SwitchOnPanel();
        //app_matrix_ledData.timerExpired = APP_MATRIX_LED_TIMER_PERIOD_ON;
    }
    //app_matrix_ledData.timerHandle = SYS_TIME_CallbackRegisterMS(_APP_MATRIX_LED_TimeExpired,
    //        (uintptr_t) &app_matrix_ledData.timerExpired, timeout_ms, SYS_TIME_SINGLE);
}


void APP_MATRIX_LED_SetPanelLine(int line)
{
    // 1. Set RGB pins
    
    // 2. Set CLK
    
    // 3. Set Latch
    
    // 4. Clear Latch
    
    // 5. Output Enable
}


void APP_MATRIX_LED_InitMatrixRed(uint8_t *matrix)
{
    int i,j;
    
    for (i=0; i<(PIXEL_FILES); i++)
    {
        // For Each Line
        for (j=0; j<(PIXEL_COLUMNS); j++)
        {
            // For each Column
            *matrix++ = 1;
        }
    }
}
	

void APP_MATRIX_LED_InitializePanel(void)
{
    // Clk
    CLK_Clear();
    PANEL_CLK_OutputEnable();
    
    // Latch
    LAT_Clear();
    PANEL_LAT_OutputEnable();
    
    // Addressing
    A_Clear();
    PANEL_A_OutputEnable();
    B_Clear();
    PANEL_B_OutputEnable();
    C_Clear();
    PANEL_C_OutputEnable();
    D_Clear();
    PANEL_D_OutputEnable();
    
    // RGB
    R1_Clear();
    PANEL_R1_OutputEnable();
    R2_Clear();
    PANEL_R2_OutputEnable();
    G1_Clear();
    //PANEL_G1_OutputEnable();
    G2_Clear();
    //PANEL_G2_OutputEnable();
    B1_Clear();
    //PANEL_B1_OutputEnable();
    B2_Clear();
    //PANEL_B2_OutputEnable();
    
    // Output Enable
    OE_Set();
    PANEL_OE_OutputEnable();
        
    APP_MATRIX_LED_SwitchOffPanel();
    //APP_MATRIX_LED_InitMatrixRed(matrix);
    APP_MATRIX_LED_RefreshPanel(image_data_Microchip_64_32);
}

/*******************************************************************************
  Function:
    void APP_MATRIX_LED_Initialize ( void )

  Remarks:
    See prototype in app_matrix_led.h.
 */

void APP_MATRIX_LED_Initialize ( void )
{   
    // Initialize Panel Led
    APP_MATRIX_LED_InitializePanel();
    
    app_matrix_ledData.state = APP_MATRIX_LED_STATE_INIT;
    
    app_matrix_ledData.refreshScreen = true;
    app_matrix_ledData.screenIndex = 0; 
    
}


/******************************************************************************
  Function:
    void APP_MATRIX_LED_Tasks ( void )

  Remarks:
    See prototype in app_matrix_led.h.
 */
extern APP_G3_MANAGEMENT_DATA app_g3_managementData;

void APP_MATRIX_LED_Tasks ( void )
{
    /* Check the application's current state. */
    switch ( app_matrix_ledData.state )
    {
        /* Application's initial state. */
        case APP_MATRIX_LED_STATE_INIT:
        {
            // Register Timer to control Output Enable
            //app_matrix_ledData.timerRefresh_handler = SYS_TIME_CallbackRegisterMS(_APP_MATRIX_LED_TimeExpired,
            //(uintptr_t) &app_matrix_ledData.timerRefresh_flag, APP_MATRIX_LED_TIMER_PERIOD, SYS_TIME_PERIODIC);
            
            //if (app_matrix_ledData.timerRefresh_handler != SYS_TIME_HANDLE_INVALID)
            //{
            //}
            
            ProtomatterStatus status;
            // Initialize Protomatter Library
            _PM_protoPtr = &core_proto;
            status = _PM_init(_PM_protoPtr, 64, 1, 1, rgbPins, 4, addrPins, clockPin, latchPin, oePin, 1, false, &timer);
            SYS_DEBUG_PRINT(SYS_ERROR_INFO, "APP_MATRIX_LED: Protomatter Init Status: 0x%X\r\n", status);
            app_matrix_ledData.state = APP_MATRIX_LED_STATE_BEGIN;
           
            break;
        }

        case APP_MATRIX_LED_STATE_BEGIN:
        { 
            if (app_g3_managementData.state == APP_G3_MANAGEMENT_STATE_JOINED)
            {

                ProtomatterStatus status;
                status = _PM_begin(_PM_protoPtr);
                SYS_DEBUG_PRINT(SYS_ERROR_INFO, "APP_MATRIX_LED: Protomatter Begin Status: 0x%X\r\n", status); 
                app_matrix_ledData.state = APP_MATRIX_LED_STATE_WAIT;                
            }
            break;
        }
        case APP_MATRIX_LED_STATE_WAIT:
        {
            if (app_matrix_ledData.refreshScreen)
            {
                uint8_t *pscreen;
                app_matrix_ledData.refreshScreen = false;
                if (app_matrix_ledData.screenIndex == 0)
                    pscreen = (uint8_t *) image_data_Microchip_64_32;
                else{
                    pscreen = (uint8_t *) image_data_Alarm_64_32;
                } 
                //_PM_convert_565(_PM_protoPtr, pscreen, 64 * 32);
            }
            break;
        }
        
        /* Error state */
        case APP_MATRIX_LED_STATE_ERROR:
        /* The default state should never be executed. */
        default:
        {
            /* Nothing more to do. Suspend task forever (RTOS mode) */
            if (app_matrix_ledData.semaphoreID != 0)
            {
                OSAL_SEM_Pend(&app_matrix_ledData.semaphoreID, OSAL_WAIT_FOREVER);
            }

            break;
        }
    }
}